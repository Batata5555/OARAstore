const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1RvIYAjv7-UEqYyZaNRNN6uY2vdwQAygdng5aPAI870M/gviz/tq?tqx=out:json';

let allProducts = [];

async function fetchProducts() {
    try {
        const response = await fetch(SHEET_URL);
        const text = await response.text();
        const data = JSON.parse(text.substr(47).slice(0, -2));
        
        allProducts = data.table.rows.map(row => ({
            name: row.c[0] ? row.c[0].v : '',      
            price: row.c[1] ? row.c[1].v : '',     
            image: row.c[2] ? row.c[2].v : '',     
            category: row.c[3] ? row.c[3].v : 'Ø¹Ø§Ù…' 
        }));
        
        console.log("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª");
        renderCategories(); // ØªØ´ØºÙŠÙ„ Ø¯Ø§Ù„Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
    } catch (error) {
        console.error("Ø®Ø·Ø£:", error);
    }
}

// Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø© Ø¹Ù† Ø¥Ø¸Ù‡Ø§Ø± "Ù…Ù„Ø§Ø¨Ø³ Ø£Ù†ÙŠÙ‚Ø©" ÙˆØ£ÙŠ Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
function renderCategories() {
    const container = document.getElementById('dynamic-categories');
    if(!container) return;

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙØ±ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„
    const categories = [...new Set(allProducts.map(p => p.category))];
    
    container.innerHTML = categories.map(cat => `
        <div class="category-card" onclick="showCategoryProducts('${cat}')">
            <div class="cat-icon">ğŸ›ï¸</div>
            <span>${cat}</span>
        </div>
    `).join('');
}

function showCategoryProducts(category) {
    const welcomeArea = document.getElementById('welcome-area');
    const productsSection = document.getElementById('products-section');
    const productsList = document.getElementById('products-list');
    const backBtn = document.getElementById('backBtn');

    const filtered = allProducts.filter(p => p.category === category);

    productsList.innerHTML = filtered.map(p => `
        <div class="card">
            <img src="${p.image}">
            <div class="p-info">
                <h3>${p.name}</h3>
                <p class="price">${p.price} â‚ª</p>
                <button class="add-btn" onclick="sendWhatsApp('${p.name}', '${p.price}')">Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
            </div>
        </div>
    `).join('');

    welcomeArea.style.display = 'none';
    productsSection.style.display = 'block';
    backBtn.style.display = 'block';
}

function sendWhatsApp(name, price) {
    const phone = "970568486065"; // Ø±Ù‚Ù…Ùƒ Ø§Ù„ØµØ­ÙŠØ­
    const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ OARA STOREØŒ Ø£Ø±ÙŠØ¯ Ø·Ù„Ø¨: ${name} Ø¨Ø³Ø¹Ø± ${price} â‚ª`;
    window.open(`https://wa.me/${phone}?text=${encodeURIComponent(msg)}`, '_blank');
}

function smoothBack() {
    location.reload(); // Ø£Ø³Ù‡Ù„ Ø·Ø±ÙŠÙ‚Ø© Ù„Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
}

fetchProducts();
